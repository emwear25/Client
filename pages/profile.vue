<template>
  <div class="profile-page">
    <div class="profile-page__container">
      <h1 class="profile-page__title">–ú–æ—è—Ç –ø—Ä–æ—Ñ–∏–ª</h1>

      <div class="profile-card">
        <div class="profile-card__section">
          <h2 class="profile-card__heading">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –ø—Ä–æ—Ñ–∏–ª–∞</h2>

          <div class="profile-info">
            <div class="profile-info__item">
              <span class="profile-info__label">–ò–º–µ–π–ª</span>
              <span class="profile-info__value">{{
                authStore.user?.email
              }}</span>
            </div>

            <div class="profile-info__item">
              <span class="profile-info__label">–ò–º–µ</span>
              <span class="profile-info__value">
                {{ authStore.fullName || '–ù–µ –µ –ø–æ—Å–æ—á–µ–Ω–æ' }}
              </span>
            </div>

            <div class="profile-info__item">
              <span class="profile-info__label">–¢–µ–ª–µ—Ñ–æ–Ω</span>
              <span class="profile-info__value">
                {{ authStore.user?.phone || '–ù–µ –µ –ø–æ—Å–æ—á–µ–Ω' }}
              </span>
            </div>

            <div class="profile-info__item">
              <span class="profile-info__label">–†–æ–ª—è</span>
              <span class="profile-info__value">
                {{
                  authStore.user?.role === 'admin' ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–ö–ª–∏–µ–Ω—Ç'
                }}
              </span>
            </div>
          </div>

          <p class="profile-card__note">
            üí° –í–∞—à–µ—Ç–æ –∏–º–µ –∏ —Ç–µ–ª–µ—Ñ–æ–Ω —â–µ –±—ä–¥–∞—Ç –ø–æ–ø—ä–ª–Ω–µ–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –ø—ä—Ä–≤–∞—Ç–∞
            –ø–æ—Ä—ä—á–∫–∞.
          </p>
        </div>

        <div class="profile-card__divider"></div>

        <!-- Saved Addresses Section -->
        <div class="profile-card__section">
          <h2 class="profile-card__heading">–ó–∞–ø–∞–∑–µ–Ω–∏ –∞–¥—Ä–µ—Å–∏</h2>

          <div v-if="authStore.user?.addresses?.length" class="addresses-grid">
            <div
              v-for="address in authStore.user.addresses"
              :key="address._id"
              class="address-card"
              :class="{ 'address-card--default': address.isDefault }"
            >
              <div class="address-card__badge-container">
                <span v-if="address.isDefault" class="address-card__badge">
                  –ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ
                </span>
                <span 
                  v-if="address.type === 'econt_office'" 
                  class="address-card__type-badge address-card__type-badge--econt"
                >
                  üì¶ –û—Ñ–∏—Å –Ω–∞ –ï–∫–æ–Ω—Ç
                </span>
                <span 
                  v-else-if="address.type === 'econt_automat'" 
                  class="address-card__type-badge address-card__type-badge--econt"
                >
                  ü§ñ –ï–∫–æ–Ω—Ç–æ–º–∞—Ç
                </span>
              </div>
              <p class="address-card__street">{{ address.street }}</p>
              <p class="address-card__city">{{ address.city }}, {{ address.postalCode }}</p>
              <p class="address-card__country">{{ address.country }}</p>
              <p v-if="address.econtOfficeName" class="address-card__econt-name">
                {{ address.econtOfficeName }}
              </p>
            </div>
          </div>
          <p v-else class="profile-card__empty">
            –ù—è–º–∞—Ç–µ –∑–∞–ø–∞–∑–µ–Ω–∏ –∞–¥—Ä–µ—Å–∏. –ê–¥—Ä–µ—Å–∏—Ç–µ —Å–µ –∑–∞–ø–∞–∑–≤–∞—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –ø–æ—Ä—ä—á–∫–∞.
          </p>
        </div>

        <div class="profile-card__divider"></div>

        <div class="profile-card__section">
          <h2 class="profile-card__heading">–ë—ä—Ä–∑–∏ –¥–µ–π—Å—Ç–≤–∏—è</h2>

          <div class="profile-actions">
            <NuxtLink to="/profile-edit" class="btn btn--primary btn--large">
              <Icon name="mdi:account-edit" />
              <span>–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π –ø—Ä–æ—Ñ–∏–ª–∞</span>
            </NuxtLink>

            <NuxtLink to="/orders" class="btn btn--secondary btn--large">
              <Icon name="mdi:package-variant" />
              <span>–ú–æ–∏—Ç–µ –ø–æ—Ä—ä—á–∫–∏</span>
            </NuxtLink>

            <NuxtLink to="/cart" class="btn btn--secondary btn--large">
              <Icon name="mdi:cart-outline" />
              <span>–ö–æ–ª–∏—á–∫–∞</span>
            </NuxtLink>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { useAuthStore } from '~/stores/auth'

// Middleware to check authentication
definePageMeta({
  middleware: 'auth',
})

const authStore = useAuthStore()

// Refresh user data on mount
onMounted(async () => {
  console.log('[Profile Page] Refreshing user data...')
  await authStore.fetchUser()
  console.log('[Profile Page] User data:', authStore.user)
})

// SEO
useHead({
  title: '–ü—Ä–æ—Ñ–∏–ª - emWear',
  meta: [
    { name: 'description', content: '–£–ø—Ä–∞–≤–ª—è–≤–∞–π—Ç–µ –≤–∞—à–∏—è –ø—Ä–æ—Ñ–∏–ª –≤ emWear' },
  ],
})
</script>

<style lang="scss" scoped>
@use '~/assets/styles/colors' as *;
@use '~/assets/styles/fonts' as *;
@use '~/assets/styles/breakpoints' as *;

.profile-page {
  min-height: 100vh;
  background: $bg-page;
  padding: 2rem 1rem;

  @include up(md) {
    padding: 3rem 1.5rem;
  }

  &__container {
    max-width: 800px;
    margin: 0 auto;
  }

  &__title {
    font-family: $font-heading;
    font-size: clamp(1.75rem, 4vw, 2.5rem);
    font-weight: 600;
    color: $brand-ink;
    margin: 0 0 2rem;
  }
}

.profile-card {
  background: $bg-card;
  border: 1px solid $border-base;
  border-radius: 16px;
  padding: 2rem;
  box-shadow: 0 4px 12px $shadow-soft;

  @include up(md) {
    padding: 2.5rem;
  }

  &__section {
    margin-bottom: 2rem;

    &:last-child {
      margin-bottom: 0;
    }
  }

  &__heading {
    font-family: $font-heading;
    font-size: 1.25rem;
    font-weight: 600;
    color: $brand-ink;
    margin: 0 0 1.5rem;
  }

  &__divider {
    height: 1px;
    background: $border-base;
    margin: 2rem 0;
  }

  &__note {
    font-family: $font-body;
    font-size: 0.875rem;
    color: $text-secondary;
    margin: 1.5rem 0 0;
    padding: 1rem;
    background: rgba($brand, 0.05);
    border-radius: 8px;
    border-left: 3px solid $brand;
  }
}

.profile-info {
  display: flex;
  flex-direction: column;
  gap: 1.25rem;

  &__item {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;

    @include up(sm) {
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
    }
  }

  &__label {
    font-family: $font-body;
    font-size: 0.875rem;
    font-weight: 500;
    color: $text-secondary;
    min-width: 120px;
  }

  &__value {
    font-family: $font-body;
    font-size: 1rem;
    color: $text-primary;
    font-weight: 500;
  }
}

.addresses-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1rem;

  @include up(md) {
    grid-template-columns: repeat(2, 1fr);
  }
}

.address-card {
  background: $bg-page;
  border: 1px solid $border-base;
  border-radius: 10px;
  padding: 1.25rem;
  position: relative;
  transition: all 0.2s;

  &:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }

  &--default {
    border-color: $brand;
    background: rgba($brand, 0.05);
  }

  &__badge-container {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
  }

  &__badge {
    display: inline-block;
    padding: 0.25rem 0.625rem;
    background: $brand;
    color: $brand-ink;
    font-size: 0.6875rem;
    font-weight: 700;
    text-transform: uppercase;
    border-radius: 4px;
    letter-spacing: 0.05em;
  }

  &__type-badge {
    display: inline-block;
    padding: 0.25rem 0.625rem;
    font-size: 0.75rem;
    font-weight: 600;
    border-radius: 4px;

    &--econt {
      background: rgba(#B9C6AA, 0.2);
      color: #2F3A2A;
      border: 1px solid #B9C6AA;
    }
  }

  &__street {
    font-family: $font-body;
    font-weight: 600;
    color: $brand-ink;
    margin: 0 0 0.375rem;
    font-size: 0.9375rem;
  }

  &__city,
  &__country,
  &__econt-name {
    font-family: $font-body;
    font-size: 0.875rem;
    color: $text-secondary;
    margin: 0.25rem 0 0;
  }

  &__econt-name {
    font-weight: 500;
    color: #2F3A2A;
    font-style: italic;
  }
}

.profile-actions {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1rem;

  @include up(sm) {
    grid-template-columns: repeat(3, 1fr);
  }

  .btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;

    svg {
      font-size: 1.25rem;
    }
  }
}
</style>
```
